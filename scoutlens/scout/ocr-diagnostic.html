<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scout OCR Diagnostic Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #0a0a0a;
            color: #ffffff;
            line-height: 1.6;
        }
        
        .test-section {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 12px;
            padding: 24px;
            margin: 20px 0;
        }
        
        .test-section h2 {
            color: #4285f4;
            margin-top: 0;
        }
        
        .test-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            margin: 8px;
            transition: transform 0.2s;
        }
        
        .test-button:hover {
            transform: translateY(-2px);
        }
        
        .status {
            background: #2a2a2a;
            border: 1px solid #444;
            border-radius: 8px;
            padding: 16px;
            margin: 16px 0;
            font-family: monospace;
            font-size: 12px;
        }
        
        .crypto-content {
            background: #2a2a2a;
            border: 1px solid #444;
            border-radius: 8px;
            padding: 16px;
            margin: 16px 0;
        }
        
        .address {
            background: #333;
            padding: 8px 12px;
            border-radius: 4px;
            font-family: monospace;
            margin: 4px 0;
            cursor: text;
        }
        
        .address:hover {
            background: #444;
        }
        
        .token-price {
            display: inline-block;
            background: #4285f4;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            margin: 2px;
            font-weight: bold;
        }
        
        .shortcut-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 16px;
            z-index: 1000;
            min-width: 200px;
        }
        
        .shortcut-key {
            background: #333;
            border: 1px solid #555;
            border-radius: 4px;
            padding: 4px 8px;
            font-family: monospace;
            font-size: 12px;
            color: #4285f4;
        }
    </style>
</head>
<body>
    <div class="shortcut-indicator">
        <h4>üîç Scout Diagnostic</h4>
        <div id="status">Ready for testing</div>
        <div style="margin-top: 8px; font-size: 12px;">
            Press <span class="shortcut-key">Ctrl+Shift+L</span> to test
        </div>
    </div>

    <h1>üîç Scout OCR Diagnostic Test</h1>
    <p>Use this page to diagnose OCR trigger issues and verify functionality</p>

    <div class="test-section">
        <h2>üéØ Test All OCR Triggers</h2>
        
        <div class="status" id="testLog">
            Test Log:
            <br>‚Ä¢ Page loaded at <span id="loadTime"></span>
            <br>‚Ä¢ Waiting for user interaction...
        </div>
        
        <div>
            <h3>Manual Tests:</h3>
            <button class="test-button" onclick="testPopupButton()">
                üì± Test Popup Button
            </button>
            <button class="test-button" onclick="testKeyboardShortcut()">
                ‚å®Ô∏è Test Keyboard Detection
            </button>
            <button class="test-button" onclick="testConsoleLog()">
                üîç Check Console Logs
            </button>
        </div>
    </div>

    <div class="test-section">
        <h2>üí∞ Crypto Content for OCR Testing</h2>
        
        <div class="crypto-content">
            <h3>Token Prices</h3>
            <div>
                <span class="token-price">ETH $3,247.82</span>
                <span class="token-price">BTC $67,892.15</span>
                <span class="token-price">USDC $1.00</span>
                <span class="token-price">UNI $8.42</span>
            </div>
        </div>
        
        <div class="crypto-content">
            <h3>Wallet Addresses (Right-click to test context menu)</h3>
            <div class="address">0x742d35Cc32cC8fC27e0b748cC6Ad4d55a3C8e9f2</div>
            <div class="address">0xA0b86a33E6417c891CE6b3e91B3Aa4BeEb9Dd9b3</div>
            <div class="address">0x28C6c06298E57e8BA25cBA7D37DE8b0d3c58Ee41</div>
        </div>
        
        <div class="crypto-content">
            <h3>Test Image (Right-click to test image OCR)</h3>
            <svg width="300" height="100" style="background: #333; border-radius: 8px; cursor: pointer;">
                <text x="10" y="25" fill="#4285f4" font-size="14">LINK Token</text>
                <text x="10" y="45" fill="#4caf50" font-size="16">$14.28</text>
                <text x="10" y="65" fill="#ffffff" font-size="12">+3.2% (24h)</text>
                <text x="10" y="85" fill="#ccc" font-size="10">Contract: 0x514910771af9ca656af840dff83e8264ecf986ca</text>
            </svg>
        </div>
    </div>

    <div class="test-section">
        <h2>üîß Expected Behavior</h2>
        <ul>
            <li><strong>Popup Button:</strong> Click Scout icon ‚Üí "Start OCR Scan" ‚Üí Results in popup</li>
            <li><strong>Keyboard Shortcut:</strong> Press Ctrl+Shift+L ‚Üí See scanning indicator ‚Üí Popup shows results</li>
            <li><strong>Context Menu - Page:</strong> Right-click empty space ‚Üí "Scout: OCR Scan Page"</li>
            <li><strong>Context Menu - Selection:</strong> Select text ‚Üí Right-click ‚Üí "Scout: Scan Selection"</li>
            <li><strong>Context Menu - Image:</strong> Right-click on image ‚Üí "Scout: OCR Scan Image"</li>
            <li><strong>Context Menu - Address:</strong> Select address ‚Üí Right-click ‚Üí "Scout: Analyze Address"</li>
        </ul>
    </div>

    <script>
        // Update load time
        document.getElementById('loadTime').textContent = new Date().toLocaleTimeString();
        
        const status = document.getElementById('status');
        const testLog = document.getElementById('testLog');
        
        function updateStatus(message, type = 'info') {
            status.textContent = message;
            addLog(message, type);
        }
        
        function addLog(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.innerHTML = `<br>‚Ä¢ [${timestamp}] ${message}`;
            
            if (type === 'success') {
                logEntry.style.color = '#4caf50';
            } else if (type === 'error') {
                logEntry.style.color = '#f44336';
            } else if (type === 'warning') {
                logEntry.style.color = '#ff9800';
            }
            
            testLog.appendChild(logEntry);
            
            // Keep only last 20 log entries
            while (testLog.children.length > 20) {
                testLog.removeChild(testLog.firstChild);
            }
            
            // Scroll to bottom
            testLog.scrollTop = testLog.scrollHeight;
        }
        
        // Test functions
        function testPopupButton() {
            addLog('Manual test: Click Scout extension icon and try OCR scan', 'info');
            updateStatus('Test popup button manually', 'info');
        }
        
        function testKeyboardShortcut() {
            addLog('Press Ctrl+Shift+L now to test keyboard shortcut', 'warning');
            updateStatus('Press Ctrl+Shift+L', 'warning');
        }
        
        function testConsoleLog() {
            console.log('=== SCOUT OCR DIAGNOSTIC ===');
            console.log('Testing console logging...');
            console.log('Chrome extension APIs available:', {
                runtime: !!chrome?.runtime,
                tabs: !!chrome?.tabs,
                contextMenus: !!chrome?.contextMenus,
                commands: !!chrome?.commands
            });
            
            addLog('Check browser console (F12) for detailed logs', 'info');
            updateStatus('Console logs printed', 'success');
        }
        
        // Listen for keyboard shortcut
        document.addEventListener('keydown', (event) => {
            if (event.ctrlKey && event.shiftKey && event.key === 'L') {
                event.preventDefault();
                addLog('Keyboard shortcut detected! (Ctrl+Shift+L)', 'success');
                updateStatus('Shortcut detected - should see Scout indicator', 'success');
                
                // Check for Scout indicator after a delay
                setTimeout(() => {
                    const indicator = document.getElementById('scout-ocr-indicator');
                    if (indicator) {
                        addLog('‚úì Scout OCR indicator appeared', 'success');
                    } else {
                        addLog('‚úó Scout OCR indicator NOT found', 'error');
                    }
                }, 500);
            }
        });
        
        // Listen for selection events
        document.addEventListener('mouseup', () => {
            const selection = window.getSelection();
            if (selection.toString().length > 5) {
                addLog(`Text selected: "${selection.toString().substring(0, 30)}..."`, 'info');
                updateStatus('Text selected - try right-click', 'info');
            }
        });
        
        // Listen for context menu events
        document.addEventListener('contextmenu', (event) => {
            const target = event.target;
            const selection = window.getSelection().toString();
            
            if (target.tagName === 'svg') {
                addLog('Right-clicked on SVG image - check for Scout OCR options', 'warning');
            } else if (selection.length > 0) {
                addLog(`Right-clicked on selection: "${selection.substring(0, 20)}..."`, 'warning');
            } else {
                addLog('Right-clicked on page - check for Scout OCR page scan', 'warning');
            }
        });
        
        // Monitor for Scout indicators
        const observer = new MutationObserver((mutations) => {
            mutations.forEach((mutation) => {
                mutation.addedNodes.forEach((node) => {
                    if (node.id === 'scout-ocr-indicator') {
                        addLog('‚úì Scout OCR scanning indicator appeared', 'success');
                    } else if (node.id === 'scout-indicator') {
                        addLog('‚úì Scout extension indicator appeared', 'success');
                    } else if (node.textContent && node.textContent.includes('Scout')) {
                        addLog(`Scout element added: ${node.textContent.substring(0, 50)}...`, 'info');
                    }
                });
            });
        });
        
        observer.observe(document.body, {
            childList: true,
            subtree: true
        });
        
        // Check for Scout content script
        setTimeout(() => {
            if (window.scoutCloseWalletPopup) {
                addLog('‚úì Scout content script loaded (wallet functions found)', 'success');
            } else {
                addLog('‚úó Scout content script may not be loaded', 'error');
            }
        }, 2000);
        
        // Initial status
        updateStatus('Diagnostic page ready - test OCR triggers', 'success');
        
        // Check extension periodically
        setInterval(() => {
            const hasScoutElements = document.querySelectorAll('[id*="scout"]').length > 0;
            if (hasScoutElements) {
                updateStatus('Scout elements detected on page', 'success');
            }
        }, 10000);
    </script>
</body>
</html>
